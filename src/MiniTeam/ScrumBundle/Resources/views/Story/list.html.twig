{% extends '::base.html.twig' %}

{% block body %}

    {{ render(controller('MiniTeamScrumBundle:Project:scrumBar', { 'project': project.slug, 'activeTab': status })) }}

    <div class="row">
        <div class="centered">
            <h3>{{ status }}</h3>
        </div>
    
        <div class="span4">

            {%  for story in stories %}

            <a href="{{ path('story_show', { 'project': project.slug,'id': story.id }) }}">
                <div class="well">
                    <p class="text-info pull-right">{{ story.points }} pts</p>
                    <span class="gray-text">#{{ story.number }}</span>
                    <span class="black-text">{{ story.title }}</span>
                </div>
            </a>

            {% endfor %}
        </div>

        {% set story = story|default(stories[0]) %}
        <div class="span8">
            <div class="row-fluid">
                <div class="well">
                    <div class="row-fluid">
                        <div class="span12">
                            <p class="lead">
                                <span class="gray-text">#{{ story.number }}</span>
                                {{ story.title }}
                            </p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="span6 offset1">
                            {{ story.details }}
                        </div>
                        <div class="span1 offset3">
                            <p class="lead text-info">{{ story.points }} pts</p>
                        </div>
                    </div>
                </div>

                <!-- gestion du statut de la user story -->

                <div class="row-fluid">
                    <div class="span2">
                    {% if story.isPlanned %}
                        <a class="btn btn-inverse" id="unplan" href="{{ path('story_unplan', { 'project': project.slug, 'id': story.id }) }}"><i class="icon-fast-backward icon-white"></i> Remove from sprint</a>
                    {% elseif story.isInProgress %}
                        <a class="btn btn-danger" id="blocked"><i class="icon-ban-circle icon-white"></i> Blocked</a>
                    {% endif %}
                    </div>
                    <div class="span8 centered">
                        <span class="label label-info" id="status">{{ story.status }}</span>
                        {% if story.isAssigned %}
                            <br><span id="assignee">{{ story.assignee.username }}</span>
                        {% endif %}
                    </div>
                    <div class="span2 align-right">
                    {% if story.isInBacklog %}
                        <a class="btn btn-info" id="plan" href="{{ path('story_plan', { 'project': project.slug, 'id': story.id }) }}"><i class="icon-plus icon-white"></i> Plan for next sprint</a>
                    {% elseif story.isPlanned %}
                        <a class="btn btn-info" id="start" href="{{ path('story_start', { 'project': project.slug, 'id': story.id }) }}"><i class="icon-play icon-white"></i> Start</a>
                    {% elseif story.isInProgress %}
                        <a class="btn btn-success" id="deliver" href="{{ path('story_deliver', { 'project': project.slug, 'id': story.id }) }}"><i class="icon-ok icon-white"></i> Deliver</a>
                    {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>


{% endblock %}